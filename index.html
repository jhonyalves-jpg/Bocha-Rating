<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ratings de Xadrez</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f4f6f8; margin:0; padding:20px; }
    h1,h2 { text-align:center; }
    table { width:100%; max-width:700px; margin:20px auto; border-collapse:collapse; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.1);}    
    th,td { padding:10px; text-align:center; border-bottom:1px solid #ddd; }
    th { background:#222; color:#fff; }
    tr:nth-child(even){ background:#f2f2f2; }
    .box { max-width:700px; margin:20px auto; background:#fff; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    input, select, button { padding:8px; margin:5px; }
    button { cursor:pointer; }
    .footer { text-align:center; font-size:14px; color:#666; margin-top:30px; }
  </style>
</head>
<body>

<h1>üèÜ Ranking de Ratings</h1>

<div class="box">
  <h2>‚ûï Adicionar Jogador</h2>
  <input id="novoNome" placeholder="Nome do jogador" />
  <input id="novoRating" type="number" placeholder="Rating inicial" value="1500" />
  <input id="novoV" type="number" placeholder="Vit√≥rias" value="0" />
  <input id="novoD" type="number" placeholder="Derrotas" value="0" />
  <button onclick="adicionarJogador()">Adicionar</button>
</div>

<div class="box">
  <h2>‚ôüÔ∏è Registrar Partida</h2>
  <select id="jogadorA"></select>
  <select id="resultado">
    <option value="1">Vit√≥ria A</option>
    <option value="0.5">Empate</option>
    <option value="0">Derrota A</option>
  </select>
  <select id="jogadorB"></select>
  <button onclick="registrarPartida()">Salvar Partida</button>
</div>

<table>
  <thead>
    <tr><th>#</th><th>Jogador</th><th>Rating</th><th>V</th><th>D</th><th>A√ß√µes</th></tr>
  </thead>
  <tbody id="ranking"></tbody>
</table>

<div class="box">
  <h2>üìú Hist√≥rico de Partidas</h2>
  <table style="max-width:100%">
    <thead>
      <tr><th>Jogador A</th><th>Resultado</th><th>Jogador B</th></tr>
    </thead>
    <tbody id="historico"></tbody>
  </table>
</div>

<div class="footer">Sistema de rating Elo ‚Ä¢ K=20 ‚Ä¢ Dados salvos no navegador</div>

<script>
  const K = 20;
  let jogadores = JSON.parse(localStorage.getItem('jogadores')) || [];

// Garante V/D para jogadores antigos
jogadores.forEach(j => { j.v ??= 0; j.d ??= 0; });

// Ajuste manual inicial de V/D (executa uma vez)
if(!localStorage.getItem('ajusteVD_v1')){
  const ajuste = {
    "Vicente": {v:2,d:0},
    "Jhony": {v:2,d:0},
    "Bruno": {v:1,d:1},
    "Shigaki": {v:1,d:1},
    "Thor": {v:1,d:1},
    "Aldemir": {v:0,d:2},
    "Vitor": {v:0,d:2}
  };
  jogadores = jogadores.filter(j => j.nome !== 'Arcari');
  jogadores.forEach(j => {
    if(ajuste[j.nome]){
      j.v = ajuste[j.nome].v;
      j.d = ajuste[j.nome].d;
    }
  });
  localStorage.setItem('ajusteVD_v1', 'ok');
}
  let historico = JSON.parse(localStorage.getItem('historico')) || [];

  function salvar(){ 
    localStorage.setItem('jogadores', JSON.stringify(jogadores));
    localStorage.setItem('historico', JSON.stringify(historico));
  }

  function esperado(ra, rb){ return 1 / (1 + Math.pow(10,(rb-ra)/400)); }

  function atualizarRanking(){
    jogadores.sort((a,b)=>b.rating-a.rating);
    const tbody = document.getElementById('ranking');
    tbody.innerHTML='';
    jogadores.forEach((j,i)=>{
      tbody.innerHTML += `<tr>
  <td>${i+1}</td>
  <td>${j.nome}</td>
  <td>${Math.round(j.rating)}</td>
  <td>${j.v}</td>
  <td>${j.d}</td>
  <td><button onclick=\"removerJogador(${i})\">üóëÔ∏è</button></td>
</tr>`;
    });
    atualizarSelects();
    salvar();
  }

  function atualizarHistorico(){
    const h = document.getElementById('historico');
    h.innerHTML='';
    historico.forEach(p=>{
      h.innerHTML += `<tr><td>${p.a}</td><td>${p.r}</td><td>${p.b}</td></tr>`;
    });
  }

  function atualizarSelects(){
    const a = document.getElementById('jogadorA');
    const b = document.getElementById('jogadorB');
    a.innerHTML = b.innerHTML = '';
    jogadores.forEach((j,i)=>{
      a.innerHTML += `<option value="${i}">${j.nome}</option>`;
      b.innerHTML += `<option value="${i}">${j.nome}</option>`;
    });
  }

  function adicionarJogador(){
  const nomeInput = document.getElementById('novoNome');
  const ratingInput = document.getElementById('novoRating');
  const vInput = document.getElementById('novoV');
  const dInput = document.getElementById('novoD');

  const nome = nomeInput.value.trim();
  const rating = parseInt(ratingInput.value);
  const v = parseInt(vInput.value) || 0;
  const d = parseInt(dInput.value) || 0;

  if(!nome) return alert('Nome inv√°lido');

  jogadores.push({ nome, rating, v, d });

  nomeInput.value='';
  ratingInput.value=1500;
  vInput.value=0;
  dInput.value=0;

  atualizarRanking();
});
  novoNome.value=''; novoRating.value=1500; novoV.value=0; novoD.value=0;
  atualizarRanking();
});
    novoNome.value='';
    atualizarRanking();
  }

  function removerJogador(index){
  if(!confirm('Remover jogador?')) return;
  jogadores.splice(index,1);
  atualizarRanking();
}

function registrarPartida(){
    const ia = jogadorA.value;
    const ib = jogadorB.value;
    if(ia===ib) return alert('Jogadores iguais');
    const sa = parseFloat(resultado.value);
    const sb = 1 - sa;

    const ra = jogadores[ia].rating;
    const rb = jogadores[ib].rating;

    const ea = esperado(ra, rb);
    const eb = esperado(rb, ra);

    jogadores[ia].rating = ra + K*(sa-ea);
    jogadores[ib].rating = rb + K*(sb-eb);

    // Atualiza vit√≥rias e derrotas
    if(sa === 1){ jogadores[ia].v++; jogadores[ib].d++; }
    if(sa === 0){ jogadores[ib].v++; jogadores[ia].d++; }

    let textoResultado = sa==1 ? '1-0' : sa==0.5 ? '¬Ω-¬Ω' : '0-1';

    historico.unshift({ a: jogadores[ia].nome, b: jogadores[ib].nome, r: textoResultado });

    atualizarRanking();
    atualizarHistorico();
  }

  atualizarRanking();
  atualizarHistorico();
</script>

</body>
</html>
